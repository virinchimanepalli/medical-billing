"use strict";var _Request=_interopRequireDefault(require("./Request"));Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=void 0;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}/**
 * Allows the user to stack the filter functions before they call any of
 *
 * select() - "get"
 *
 * insert() - "post"
 *
 * update() - "patch"
 *
 * delete() - "delete"
 *
 * Once any of these are called the filters are passed down to the Request
 *
 * @class
 * @param {string} url The full URL
 */var Builder=/*#__PURE__*/function(){function a(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=2<arguments.length?arguments[2]:void 0;_classCallCheck(this,a),this.url=b,this.queryFilters=[],this.headers=c,this.schema=d}return _createClass(a,[{key:"request",value:function request(a){return this.schema&&("GET"==a?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),new _Request["default"](a,this.url,this.headers)}},{key:"addFilters",value:function addFilters(a){this.queryFilters.forEach(function(b){switch(b.filter){case"filter":a.filter(b.columnName,b.operator,b.criteria);break;case"not":a.not(b.columnName,b.operator,b.criteria);break;case"or":a.or(b.filters);break;case"match":a.match(b.query);break;case"order":a.order(b.columnName,b.ascending,b.nullsFirst);break;case"limit":a.limit(b.criteria,b.columnName);break;case"offset":a.offset(b.criteria,b.columnName);break;case"range":a.range(b.from,b.to);break;case"single":a.single();break;default:}})}},{key:"filter",value:function filter(a,b,c){return this.queryFilters.push({filter:"filter",columnName:a,operator:b,criteria:c}),this}},{key:"not",value:function not(a,b,c){return this.queryFilters.push({filter:"not",columnName:a,operator:b,criteria:c}),this}},{key:"or",value:function or(a){return this.queryFilters.push({filter:"or",filters:a}),this}},{key:"match",value:function match(a){return this.queryFilters.push({filter:"match",query:a}),this}},{key:"order",value:function order(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];return this.queryFilters.push({filter:"order",columnName:a,ascending:b,nullsFirst:c}),this}},{key:"limit",value:function limit(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return this.queryFilters.push({filter:"limit",criteria:a,columnName:b}),this}},{key:"offset",value:function offset(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return this.queryFilters.push({filter:"offset",columnName:b,criteria:a}),this}},{key:"range",value:function range(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return this.queryFilters.push({filter:"range",from:a,to:b}),this}},{key:"single",value:function single(){return this.queryFilters.push({filter:"single"}),this}/**
   * Start a "GET" request
   */},{key:"select",value:function select(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",b=this.request("GET");return b.select(a),this.addFilters(b),b}/**
   * Start a "POST" request
   */},{key:"insert",value:function insert(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{upsert:!1},c=this.request("POST"),d=b.upsert?"return=representation,resolution=merge-duplicates":"return=representation";return c.set("Prefer",d),c.send(a),this.addFilters(c),c}/**
   * Start a "PATCH" request
   */},{key:"update",value:function update(a){var b=this.request("PATCH");return Array.isArray(a)?{body:null,status:400,statusCode:400,statusText:"Data type should be an object."}:(b.set("Prefer","return=representation"),b.send(a),this.addFilters(b),b)}/**
   * Start a "DELETE" request
   */},{key:"delete",value:function _delete(){var a=this.request("DELETE");return this.addFilters(a),a}}]),a}(),advancedFilters=["eq","neq","gt","lt","gte","lte","like","ilike","is","in","fts","plfts","phfts","wfts","cs","cd","ova","ovr","sl","sr","nxr","nxl","adj"];// pre-empts if any of the filters are used before select
advancedFilters.forEach(function(a){return Builder.prototype[a]=function(b,c){return this.filter(b,a,c),this}});var _default=Builder;exports["default"]=_default;